<!--
// Copyright 2015 Google Inc.
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//     http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

// Author: Corey Goldfeder
// Contributor: Schuyler Duveen
-->

<style>
  body { padding:10px }
  h2 { color:#4d90fe; font-weight:bold }
  button { 
    color:white;
    background-color: hsl(217,99%,65%);
    border:solid #3079ed 1px;
    border-radius:4px;
    font-size:13pt;
    padding:5px;
    font-weight:bold
  }
  button:hover {
    background-color: hsl(217,99%,70%);
  }
  button.done {
    background-color: hsl(217,30%,70%);
  }
  .invisible { display:none }
</style>
<script>
  function $(x) { return document.getElementById(x); }
  function show(id, newcls) {$(id).className = newcls||''; }
  function hide(id) {$(id).className = 'invisible'; }
  var runner = google.script.run
    .withFailureHandler(function(error, message) {
      console.log(error, message);
      alert('Error while ' + message + ': ' + error.message);
    });    
  function install() {
    runner.withSuccessHandler(function() { 
      hide('install');
      show('update', 'done');
      show('uninstall');
    }).install({
      numDays: $('numDays').value, 
      markUnread: $('markUnread').checked, 
      addUnsnoozed: $('addUnsnoozed').checked,
      calendarNotificationsToGuests: $('calendarReminders').checked,
      debugTime: $('debugTime').checked
    });
  }
  function uninstall() {
    runner.withSuccessHandler(function() { 
      show('install');
      hide('update');
      hide('uninstall');
    }).uninstall();
  }
  function debuginfo() {
    runner.withSuccessHandler(function(data) {
      console.log(data);
    }).getMatchingDrafts(false, false, true)
  }
  function debugSend() {
    runner.withSuccessHandler(function(data) {
      console.log(data);
    }).getMatchingDrafts("snooze_test", true)
  }
</script>
<h2>Gmail Snooze</h2>
Maintain <input id='numDays' value='<?= numDays ?>'> days of snooze labels <br>
<input type='checkbox' <?= markUnread ? 'checked' : '' ?> id='markUnread'>
Mark unread when unsnoozing<br>
<input type='checkbox' <?= addUnsnoozed ? 'checked' : '' ?> id='addUnsnoozed'>
Add unsnoozed label when unsnoozing<br>
<input type='checkbox' <?= calendarNotificationsToGuests ? 'checked' : '' ?> id='calendarReminders'>
Enable Calendar reminder notifications to guests (see below)<br>
<button onclick='install()' id ='install' class='<?= installed ? 'invisible' : '' ?>'>Install</button>
<button onclick='install()' id ='update' class='<?= installed ? '' : 'invisible' ?>'>Save</button> 
<button onclick='uninstall()' id='uninstall' class='<?= installed ? '' : 'invisible' ?>'>Uninstall</button>

<h3>Features</h3>

<ul>
  <li>
    Label something as <code>Snooze/Snooze 1 days</code> and then it will be brought back to your inbox
    in 1 day (at 9am).
  <li>
    You can also snooze <b>Draft Messages</b> which will send on the right day.
  <li>
    If you tag any message with e.g. <code>snooze_20161231</code> (date format is <code>yyyymmdd</code>, do not skip zeros) then it will trigger (again, at 9am) on the date in question.
  <li>
    If you have enabled Calendar Reminders, then all events that:
    <br />
    1. Have guests that have not marked NO in attendance
    <br />
    2. Setup an '<b>Email Notification</b>' (the Calendar notification annoyingly just goes to yourself)
    <br />
    Then this script will send an email with the event title as subject line, and include the Location and Description of the event in the body (hint: if you want to send new details in the reminder, just modify the description, but don't send an update).
</ul>
<h3>Code</h3>
<p>
[<a href="https://github.com/MoveOnOrg/gmailsnooze" target="_blank">source code</a>]
<p>
Testing/Debugging: Make 1 day=1 minute
<input type='checkbox' <?= debugTime ? 'checked' : '' ?> id='debugTime'>
<div id="debug" class='<?= debugTime ? '' : 'invisible' ?>'>
  <button onclick='debuginfo()' id='debuginfo'>debuginfo</button> (see console)
  <br>
  <button onclick='debugSend()' id='debugtest'>debug send label 'snooze_test'</button>
</div>
